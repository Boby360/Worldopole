import json
from math import sqrt

types = {
    1: 'Normal',
    2: 'Fighting',
    3: 'Flying',
    4: 'Poison',
    5: 'Ground',
    6: 'Rock',
    7: 'Bug',
    8: 'Ghost',
    9: 'Steel',
    10: 'Fire',
    11: 'Water',
    12: 'Grass',
    13: 'Electric',
    14: 'Psychic',
    15: 'Ice',
    16: 'Dragon',
    17: 'Fairy',
    18: 'Dark',
    100: 'Random',
    101: 'Unknown'
}

multipliers = {
    "1": 0.0939999967813491,
    "1.5": 0.135137430784308,
    "2": 0.166397869586944,
    "2.5": 0.192650914456886,
    "3": 0.215732470154762,
    "3.5": 0.236572655026622,
    "4": 0.255720049142837,
    "4.5": 0.273530381100769,
    "5": 0.290249884128570,
    "5.5": 0.306057381335773,
    "6": 0.321087598800659,
    "6.5": 0.335445032295077,
    "7": 0.349212676286697,
    "7.5": 0.362457748778790,
    "8": 0.375235587358474,
    "8.5": 0.387592411085168,
    "9": 0.399567276239395,
    "9.5": 0.411193549517250,
    "10": 0.422500014305114,
    "10.5": 0.432926413410414,
    "11": 0.443107545375824,
    "11.5": 0.453059953871985,
    "12": 0.462798386812210,
    "12.5": 0.472336077786704,
    "13": 0.481684952974319,
    "13.5": 0.490855810259008,
    "14": 0.499858438968658,
    "14.5": 0.508701756943992,
    "15": 0.517393946647644,
    "15.5": 0.525942508771329,
    "16": 0.534354329109191,
    "16.5": 0.542635762230353,
    "17": 0.550792694091796,
    "17.5": 0.558830599438087,
    "18": 0.566754519939422,
    "18.5": 0.574569148039264,
    "19": 0.582278907299041,
    "19.5": 0.589887911977272,
    "20": 0.597400009632110,
    "20.5": 0.604823657502073,
    "21": 0.612157285213470,
    "21.5": 0.619404110566050,
    "22": 0.626567125320434,
    "22.5": 0.633649181622743,
    "23": 0.640652954578399,
    "23.5": 0.647580963301656,
    "24": 0.654435634613037,
    "24.5": 0.661219263506722,
    "25": 0.667934000492096,
    "25.5": 0.674581899290818,
    "26": 0.681164920330047,
    "26.5": 0.687684905887771,
    "27": 0.694143652915954,
    "27.5": 0.700542893277978,
    "28": 0.706884205341339,
    "28.5": 0.713169102333341,
    "29": 0.719399094581604,
    "29.5": 0.725575616972598,
    "30": 0.731700003147125,
    "30.5": 0.734741011137376,
    "31": 0.737769484519958,
    "31.5": 0.740785574597326,
    "32": 0.743789434432983,
    "32.5": 0.746781208702482,
    "33": 0.749761044979095,
    "33.5": 0.752729105305821,
    "34": 0.755685508251190,
    "34.5": 0.758630366519684,
    "35": 0.761563837528228,
    "35.5": 0.764486065255226,
    "36": 0.767397165298461,
    "36.5": 0.770297273971590,
    "37": 0.773186504840850,
    "37.5": 0.776064945942412,
    "38": 0.778932750225067,
    "38.5": 0.781790064808426,
    "39": 0.784636974334716,
    "39.5": 0.787473583646825,
    "40": 0.790300011634826,
    "40.5": 0.792803950958807,
    "41": 0.795300006866455,
    "41.5": 0.797803921486970,
    "42": 0.800300002098083,
    "42.5": 0.802803892322847,
    "43": 0.805299997329711,
    "43.5": 0.807803863460723,
    "44": 0.810299992561340,
    "44.5": 0.812803834895026,
    "45": 0.815299987792968,
    "45.5": 0.817803806620319,
    "46": 0.820299983024597,
    "46.5": 0.822803778631297,
    "47": 0.825299978256225,
    "47.5": 0.827803750922782,
    "48": 0.830299973487854,
    "48.5": 0.832803753381377,
    "49": 0.835300028324127,
    "49.5": 0.837803755931569,
    "50": 0.840300023555755
}

with open('core/json/pokedexold.json') as f:
    content = json.load(f)

    with open('base_stats.json') as f2:
        base_stats = json.load(f2)

        pokedex = {}
        for entry in base_stats:
            key = int(entry)
            stats = base_stats[entry]
            pkm = content.get('pokemon').get(str(key), {})
            pkm['atk'] = int(stats.get('attack'))
            pkm['def'] = int(stats.get('defense'))
            pkm['sta'] = int(stats.get('stamina'))
            type1 = stats.get('type1')
            type2 = stats.get('type2')
            pkm['types'] = []
            pkm['types'].append(types[type1])
            if type2 != None:
                pkm['types'].append(types[type2])
            if pkm.get('rating', 1) == 1:
                ivsum = (pkm['atk'] + pkm['def'] + pkm['sta']) / 500
                pkm['rating'] = int(5 * ivsum * ivsum) / 2
            pkm['max_cp'] = int((pkm['atk'] + 15) * sqrt(pkm['def'] + 15)
                                * sqrt(pkm['sta'] + 15) * (multipliers[str(50)]**2) / 10)
            if pkm.get('quick_move') is None:
                pkm['quick_move'] = '?'
            if pkm.get('charge_move') is None:
                pkm['charge_move'] = '?'
            pkm['candy_id'] = key
            pkm['weight'] = float(stats.get('weight'))
            pkm['height'] = float(stats.get('height'))
            pkm['generation'] = int(stats.get('generation'))
            pkm['legendary'] = bool(stats.get('legendary'))

            pokedex[key] = pkm

    for entry in base_stats:
        evos = base_stats[entry].get('evolutions')
        for evo in evos:
            pkm = pokedex[int(evo)]
            if pkm['candy_id'] > int(entry):
                pkm['candy_id'] = int(entry)

    content['pokemon'] = pokedex

    with open('core/json/pokedex.json', 'w') as outfile:
        json.dump(content, outfile, indent=4, sort_keys=True)
